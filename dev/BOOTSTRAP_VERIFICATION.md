# Bootstrap Verification Test

This document verifies that the bootstrap data integration with MinIO works correctly.

## Image Upload Verification ✅

**MinIO Status:**

- Bucket: `ecommerce-images`
- Path: `products/`
- Total Images: 30+ product images uploaded

**Test Result:**

```powershell
Invoke-WebRequest -Uri "http://localhost:9000/ecommerce-images/products/running-shoes-1.jpg" -Method Head
StatusCode: 200 ✅
```

## Bootstrap S3 Key Mapping

**Bootstrap Code Path Format:**

```java
"/images/products/headphones-1.jpg"
```

**Converted to S3 Key:**

```java
"products/headphones-1.jpg"  // Strips "/images/" prefix
```

**Stored in MinIO at:**

```
http://localhost:9000/ecommerce-images/products/headphones-1.jpg
```

**Configuration:**

```yaml
aws.s3.bucket: ecommerce-images
aws.s3.endpoint: http://localhost:9000
```

## Product-to-Image Mapping

Each product in bootstrap references images like:

| Product                       | Image Paths                                                                                                            |
| ----------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| Wireless Bluetooth Headphones | `/images/products/headphones-1.jpg`, `/images/products/headphones-2.jpg`                                               |
| Smart Fitness Watch           | `/images/products/fitness-watch-1.jpg`, `/images/products/fitness-watch-2.jpg`, `/images/products/fitness-watch-3.jpg` |
| Running Shoes Pro             | `/images/products/running-shoes-1.jpg`, `/images/products/running-shoes-2.jpg`, `/images/products/running-shoes-3.jpg` |

These are converted to S3 keys and stored in the `product_images` table with:

- `s3_key`: `products/running-shoes-1.jpg`
- `s3_bucket`: `ecommerce-images`
- `url`: Presigned URL generated by S3Service

## Expected Flow

1. **Bootstrap runs** (on first startup with empty database)
2. **Creates 12 products** with details
3. **For each image path:**
   - Converts `/images/products/X.jpg` → `products/X.jpg`
   - Calls `imageService.createImage(product, request)`
   - ImageService calls `s3Service.generatePresignedDownloadUrl("products/X.jpg")`
   - Creates Image record in database with S3 key and presigned URL
4. **Frontend fetches products** with their images
5. **Images display** using the presigned URLs

## Testing Instructions

1. **Start infrastructure:**

   ```powershell
   cd dev
   docker compose up -d
   ```

2. **Verify images uploaded:**

   ```powershell
   docker logs ecommerce-minio-setup | Select-String "Uploaded product images"
   ```

3. **Start catalog service:**

   ```powershell
   cd backend/services/catalog-service
   mvn spring-boot:run
   ```

4. **Check bootstrap logs:**

   ```
   Look for: "Initializing sample products..."
   Look for: "Created product: Wireless Bluetooth Headphones (ID: 1)"
   Look for: "Successfully created image with ID: X"
   ```

5. **Verify via API:**

   ```powershell
   # Get all products
   Invoke-RestMethod -Uri "http://localhost:8082/api/catalog/products"

   # Get product images
   Invoke-RestMethod -Uri "http://localhost:8082/api/catalog/products/1/images"
   ```

6. **Check MinIO Console:**
   - Open http://localhost:9001
   - Login: minioadmin / minioadmin
   - Navigate to: Buckets → ecommerce-images → products/
   - Verify 30+ images present

## Status: ✅ VERIFIED

- ✅ Images generated via Python script
- ✅ Images uploaded to MinIO via minio-setup container
- ✅ Images accessible at public URLs
- ✅ S3 key format matches bootstrap code expectations
- ✅ Configuration points to correct bucket and endpoint
- ✅ Ready for bootstrap to run
